<div class="ui-filter-panel">
  <div class="ui-filter-header">
    <h3 class="ui-filter-title">{{ translate.instant('filter.title') }}</h3>
    <div class="ui-filter-header-right">
      <ui-select
        [options]="logicOptions"
        [ngModel]="currentFilter.logic"
        (valueChange)="onLogicChange($event)"
        class="ui-filter-logic-select">
      </ui-select>
    </div>
  </div>

  <div class="ui-filter-body">

    <div class="ui-filter-conditions">
      <div *ngFor="let condition of currentFilter.conditions; let i = index" class="ui-filter-condition">
        <div class="ui-filter-condition-row">
          <label class="ui-filter-field-label">{{ getFieldLabel(condition.field) }}</label>

          <div class="ui-filter-operator">
            <ui-select
              [options]="getOperatorsForField(condition.field)"
              [ngModel]="condition.operator"
              (valueChange)="onOperatorChange(i, $event)"
              [placeholder]="getTranslatedPlaceholder('FILTER_OPERATOR')">
            </ui-select>
          </div>

          <div class="ui-filter-value" *ngIf="requiresValue(condition.operator)">
            <!-- Between operator -->
            <div *ngIf="condition.operator === 'between'" class="ui-filter-between">
              <!-- Date type for between -->
              <input
                *ngIf="isDateType(condition.field)"
                [type]="getDateInputType(condition.field)"
                class="ui-filter-date-input"
                [ngModel]="getBetweenMin(condition.value)"
                (ngModelChange)="onBetweenMinChange(i, $event)"
                [placeholder]="getTranslatedPlaceholder('FILTER_MIN')">
              <!-- Non-date type for between -->
              <ui-input
                *ngIf="!isDateType(condition.field)"
                [ngModel]="getBetweenMin(condition.value)"
                (valueChange)="onBetweenMinChange(i, $event)"
                [type]="getFieldType(condition.field)"
                [placeholder]="getTranslatedPlaceholder('FILTER_MIN')">
              </ui-input>
              <span class="ui-filter-between-separator">-</span>
              <!-- Date type for between -->
              <input
                *ngIf="isDateType(condition.field)"
                [type]="getDateInputType(condition.field)"
                class="ui-filter-date-input"
                [ngModel]="getBetweenMax(condition.value)"
                (ngModelChange)="onBetweenMaxChange(i, $event)"
                [placeholder]="getTranslatedPlaceholder('FILTER_MAX')">
              <!-- Non-date type for between -->
              <ui-input
                *ngIf="!isDateType(condition.field)"
                [ngModel]="getBetweenMax(condition.value)"
                (valueChange)="onBetweenMaxChange(i, $event)"
                [type]="getFieldType(condition.field)"
                [placeholder]="getTranslatedPlaceholder('FILTER_MAX')">
              </ui-input>
            </div>

            <!-- Checkbox type (radio options for single selection) -->
            <div *ngIf="condition.operator !== 'between' && isCheckboxType(condition.field)" class="ui-filter-checkbox-group">
              <label *ngFor="let option of getListOptions(condition.field)" class="ui-filter-checkbox-option">
                <input
                  type="radio"
                  [name]="'filter-checkbox-' + i"
                  [checked]="isCheckboxValueChecked(condition.value, option.value)"
                  (change)="onCheckboxChange(i, option.value, $event)"
                  class="ui-filter-checkbox">
                <span>{{ option.label }}</span>
              </label>
            </div>

            <!-- List type (single select) -->
            <ui-select
              *ngIf="condition.operator !== 'between' && !isCheckboxType(condition.field) && isListType(condition.field)"
              [options]="getListOptions(condition.field)"
              [ngModel]="condition.value"
              (valueChange)="onValueChange(i, $event)"
              [placeholder]="getTranslatedPlaceholder('FILTER_SELECT_VALUE')">
            </ui-select>

            <!-- Enum type (multi select) -->
            <ui-select
              *ngIf="condition.operator !== 'between' && !isCheckboxType(condition.field) && !isListType(condition.field) && isEnumType(condition.field)"
              [options]="getEnumOptions(condition.field)"
              [ngModel]="condition.value || []"
              (valueChange)="onEnumValueChange(i, $event)"
              [multiple]="true"
              [placeholder]="getTranslatedPlaceholder('FILTER_SELECT_VALUES')">
            </ui-select>

            <!-- Date type (date picker) -->
            <input
              *ngIf="condition.operator !== 'between' && !isCheckboxType(condition.field) && !isListType(condition.field) && !isEnumType(condition.field) && isDateType(condition.field)"
              [type]="getDateInputType(condition.field)"
              class="ui-filter-date-input"
              [ngModel]="condition.value"
              (ngModelChange)="onValueChange(i, $event)"
              [placeholder]="getTranslatedPlaceholder('FILTER_SELECT_DATE')">

            <!-- Regular input for other types -->
            <ui-input
              *ngIf="condition.operator !== 'between' && !isCheckboxType(condition.field) && !isListType(condition.field) && !isEnumType(condition.field) && !isDateType(condition.field)"
              [ngModel]="condition.value"
              (valueChange)="onValueChange(i, $event)"
              [type]="getFieldType(condition.field)"
              [placeholder]="getTranslatedPlaceholder('FILTER_VALUE')">
            </ui-input>
          </div>

          <div class="ui-filter-actions">
            <button
              type="button"
              class="ui-filter-remove-btn"
              [disabled]="currentFilter.conditions.length === 1"
              (click)="removeCondition(i)"
              aria-label="Remove condition">
              ×
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="ui-filter-actions-bar">
      <ui-select
        [options]="fieldOptions"
        [ngModel]="selectedFieldForAdd"
        (valueChange)="onSelectedFieldForAddChange($event)"
        [placeholder]="getTranslatedPlaceholder('FILTER_SELECT_FIELD')"
        class="ui-filter-add-field-select">
      </ui-select>
      <ui-button variant="secondary" size="sm" (clicked)="addCondition()">
        {{ translate.instant('filter.addCondition') }}
      </ui-button>
    </div>
  </div>

  <div class="ui-filter-footer">
    <div class="ui-filter-footer-left">
      <label class="ui-filter-limit-label">{{ translate.instant('filter.recordLimit') }}</label>
      <ui-select
        [options]="getLimitOptions()"
        [ngModel]="currentLimit"
        (valueChange)="onLimitChange($event)"
        class="ui-filter-limit-select">
      </ui-select>
    </div>
    <div class="ui-filter-footer-right">
      <ui-button 
        *ngIf="(enableReportSave && hasValidFilters)" 
        variant="secondary" 
        size="sm" 
        (clicked)="openReportSaveModal()"
        class="ui-filter-save-report-btn">
        <i class="ti ti-file-text me-1"></i>
        {{ translate.instant('filter.saveAsReport') || 'Rapor Olarak Kaydet' }}
      </ui-button>
      <ui-button variant="secondary" size="sm" (clicked)="onClose()">{{ translate.instant('filter.close') }}</ui-button>
      <ui-button variant="secondary" size="sm" (clicked)="clearFilter()">{{ translate.instant('filter.clear') }}</ui-button>
      <ui-button variant="primary" size="sm" (clicked)="applyFilter()">{{ translate.instant('filter.search') }}</ui-button>
    </div>
  </div>
</div>

<!-- Report Save Modal -->
<ui-modal
  [show]="showReportSaveModal"
  [title]="translate.instant('filter.saveAsReport') || 'Rapor Olarak Kaydet'"
  [size]="'md'"
  [closable]="true"
  [showFooter]="true"
  (showChange)="showReportSaveModal = $event"
  (closed)="closeReportSaveModal()">
  
  <div class="ui-report-save-modal-content">
    <div class="form-group">
      <label class="form-label">
        <i class="ti ti-file-text me-1"></i>
        {{ translate.instant('filter.reportName') || 'Rapor Adı' }}
      </label>
      <ui-input
        [(ngModel)]="reportName"
        [placeholder]="translate.instant('filter.enterReportName') || 'Rapor adı giriniz...'"
        (keyup.enter)="saveReport()">
      </ui-input>
    </div>
    
    <div class="alert alert-info">
      <i class="ti ti-info-circle me-2"></i>
      {{ translate.instant('filter.reportSaveInfo') || 'Mevcut filtreler rapor şablonu olarak kaydedilecektir.' }}
    </div>
  </div>
  
  <div slot="footer" class="modal-footer">
    <ui-button variant="secondary" size="sm" (clicked)="closeReportSaveModal()">
      <i class="ti ti-x me-1"></i>
      {{ translate.instant('common.cancel') || 'İptal' }}
    </ui-button>
    <ui-button variant="primary" size="sm" (clicked)="saveReport()" [disabled]="!reportName || !reportName.trim()">
      <i class="ti ti-check me-1"></i>
      {{ translate.instant('common.save') || 'Kaydet' }}
    </ui-button>
  </div>
</ui-modal>

<div class="blank-layout-container justify-content-center">
  <div class="position-relative row w-100 h-100">
    <div [class]="activeSettings.loginImage && activeSettings.loginImage !== '' ? 'col-lg-4' : 'col-lg-12'">
      <div
        class="d-flex align-items-start align-items-lg-center justify-content-center h-100"
      >
        <div class="row justify-content-center w-100 h-100 align-items-center">
          <div class="col-lg-9 max-width-form">
            <a [routerLink]="['/']">
              <img
                [src]="activeSettings.logoUrlLogin"
                class="align-middle m-2"
                style="height: 50px;"
                alt="logo"
              />
            </a>
            <h4 class="f-w-700 f-s-24 m-t-24 m-b-8">{{ 'forgotPassword.title' | translate }}</h4>
            
            @if(isSuccess) {
            <div class="m-t-16 p-16 bg-light-success rounded">
              <p class="f-s-14 text-success m-0">
                {{ 'forgotPassword.successMessage' | translate }}
              </p>
            </div>
            <div class="m-t-30">
              <a
                [routerLink]="['/authentication/login']"
                mat-flat-button
                color="primary"
                class="w-100"
              >
                {{ 'forgotPassword.backToLogin' | translate }}
              </a>
            </div>
            } @else {
            
            <!-- Adım 1: Kimlik Numarası -->
            @if(step === 1) {
            <span class="f-s-14 d-block f-s-14 m-t-8"
              >{{ 'forgotPassword.description' | translate }}</span
            >
            <form class="m-t-30" [formGroup]="identificationForm" (ngSubmit)="submitIdentification()">
              <mat-label class="f-s-14 f-w-600 m-b-12 d-block"
                >{{ 'forgotPassword.identificationNumber' | translate }}</mat-label
              >
              <mat-form-field
                appearance="outline"
                class="w-100"
                color="primary"
              >
                <input matInput formControlName="identificationNumber" />
                @if(f1['identificationNumber'].touched && f1['identificationNumber'].invalid) {
                <mat-hint class="m-b-16 error-msg">
                  @if(f1['identificationNumber'].errors && f1['identificationNumber'].errors['required']) {
                  <div class="text-error">{{ 'forgotPassword.identificationNumberRequired' | translate }}</div>
                  }
                </mat-hint>
                }
              </mat-form-field>

              <button
                mat-flat-button
                color="primary"
                class="w-100"
                [disabled]="!identificationForm.valid || isLoading"
              >
                @if(isLoading) {
                <span class="d-flex align-items-center justify-content-center">
                  <mat-progress-spinner diameter="20" mode="indeterminate" class="m-r-8"></mat-progress-spinner>
                  {{ 'forgotPassword.submitting' | translate }}
                </span>
                } @else {
                Kod Gönder
                }
              </button>
              <a
                [routerLink]="['/authentication/login']"
                mat-stroked-button
                color="primary"
                class="w-100 m-t-8"
              >
                {{ 'forgotPassword.backToLogin' | translate }}
              </a>
            </form>
            }
            
            <!-- Adım 2: Kod ve Şifre -->
            @if(step === 2) {
            <span class="f-s-14 d-block f-s-14 m-t-8"
              >Tek kullanımlık kodunuzu, yeni şifrenizi ve şifre tekrarınızı girin.</span
            >
            <form class="m-t-30" [formGroup]="resetForm" (ngSubmit)="submitReset()">
              <!-- Tek Kullanımlık Kod -->
              <mat-label class="f-s-14 f-w-600 m-b-12 d-block">Tek Kullanımlık Kod</mat-label>
              <mat-form-field
                appearance="outline"
                class="w-100"
                color="primary"
              >
                <input matInput formControlName="verificationCode" placeholder="Kodunuzu girin" />
                @if(f2['verificationCode'].touched && f2['verificationCode'].invalid) {
                <mat-hint class="m-b-16 error-msg">
                  @if(f2['verificationCode'].errors && f2['verificationCode'].errors['required']) {
                  <div class="text-error">Tek kullanımlık kod gereklidir.</div>
                  }
                </mat-hint>
                }
              </mat-form-field>

              <!-- Yeni Şifre -->
              <mat-label class="f-s-14 f-w-600 m-b-12 d-block m-t-16">Yeni Şifre</mat-label>
              <mat-form-field
                appearance="outline"
                class="w-100"
                color="primary"
              >
                <input matInput type="password" formControlName="newPassword" placeholder="Yeni şifrenizi girin" />
                @if(f2['newPassword'].touched && f2['newPassword'].invalid) {
                <mat-hint class="m-b-16 error-msg">
                  @if(f2['newPassword'].errors && f2['newPassword'].errors['required']) {
                  <div class="text-error">Şifre gereklidir.</div>
                  } @else if(f2['newPassword'].errors && f2['newPassword'].errors['minlength']) {
                  <div class="text-error">Şifre en az 6 karakter olmalıdır.</div>
                  }
                </mat-hint>
                }
              </mat-form-field>

              <!-- Şifre Tekrar -->
              <mat-label class="f-s-14 f-w-600 m-b-12 d-block m-t-16">Şifre Tekrar</mat-label>
              <mat-form-field
                appearance="outline"
                class="w-100"
                color="primary"
              >
                <input matInput type="password" formControlName="confirmPassword" placeholder="Şifrenizi tekrar girin" />
                @if(f2['confirmPassword'].touched && f2['confirmPassword'].invalid) {
                <mat-hint class="m-b-16 error-msg">
                  @if(f2['confirmPassword'].errors && f2['confirmPassword'].errors['required']) {
                  <div class="text-error">Şifre tekrar gereklidir.</div>
                  } @else if(resetForm.errors && resetForm.errors['passwordMismatch']) {
                  <div class="text-error">Şifreler eşleşmiyor.</div>
                  }
                </mat-hint>
                }
              </mat-form-field>

              <button
                mat-flat-button
                color="primary"
                class="w-100 m-t-16"
                [disabled]="!resetForm.valid || isLoading"
              >
                @if(isLoading) {
                <span class="d-flex align-items-center justify-content-center">
                  <mat-progress-spinner diameter="20" mode="indeterminate" class="m-r-8"></mat-progress-spinner>
                  Güncelleniyor...
                </span>
                } @else {
                Şifreyi Güncelle
                }
              </button>
              
              <button
                type="button"
                mat-stroked-button
                color="primary"
                class="w-100 m-t-8"
                (click)="goBack()"
                [disabled]="isLoading"
              >
                Geri Dön
              </button>
              
              <a
                [routerLink]="['/authentication/login']"
                mat-stroked-button
                color="primary"
                class="w-100 m-t-8"
              >
                {{ 'forgotPassword.backToLogin' | translate }}
              </a>
            </form>
            }
            
            }
          </div>
        </div>
      </div>
    </div>
    
    @if(activeSettings.loginImage && activeSettings.loginImage !== '') {  
      <div class="col-lg-8 position-relative overflow-hidden d-none d-lg-block">
          <img id="randomImage" alt="backgroundPhoto" style="width: 100%; height: 100%; object-fit: cover;" [src]="activeSettings.loginImage"/>
      </div>
      }
  </div>
</div>

<!-- LiveView Component Template -->
<div class="live-view-page">
  <!-- Sayfa açıldığında gösterilen bağlantı modalı: terminal grubu seçip Bağlan -->
  <ui-modal
    [show]="showConnectForm"
    [title]="'Geçişleri İzle - Terminal Seçin'"
    [size]="'lg'"
    [closable]="false"
    [showFooter]="true"
    [backdropClose]="false"
    [hideSidebarWhenOpen]="false">
    <div class="filter-modal-content">
      <p class="text-muted mb-3">İzlemek istediğiniz terminal grubunu seçin ve Bağlan'a tıklayın.</p>
      <div class="form-group">
        <label>Grup:</label>
        <ui-select
          [(ngModel)]="selectedLiveViewSettingId"
          [options]="liveViewSettings"
          [placeholder]="'Grup seçiniz...'"
          (ngModelChange)="onLiveViewSettingChange()">
        </ui-select>
      </div>
      <div class="form-group" *ngIf="selectedTerminals.length > 0">
        <label>Seçili Terminaller ({{ selectedTerminals.length }}):</label>
        <div class="terminals-list-container">
          <ui-data-table
            [id]="'connect-terminals-grid'"
            [columns]="terminalsTableColumns"
            [dataSource]="terminalsDataSource"
            [selectable]="false"
            [pagination]="true"
            [pageSize]="10"
            [height]="'280px'"
            [recid]="'ReaderID'"
            [showRefresh]="false"
            [showFooter]="true"
            [toolbar]="terminalsTableToolbarConfig">
          </ui-data-table>
        </div>
      </div>
      <div class="form-group" *ngIf="selectedLiveViewSettingId && selectedTerminals.length === 0">
        <div class="alert alert-info">
          <i class="ti ti-info-circle me-2"></i>
          Bu grup için terminal bulunamadı.
        </div>
      </div>
    </div>
    <div slot="footer" class="modal-footer">
      <button type="button" class="btn btn-primary" (click)="onConnect()" [disabled]="selectedTerminals.length === 0">
        Bağlan
      </button>
    </div>
  </ui-modal>

  <!-- Grid: sadece Bağlan'dan sonra -->
  <div class="container-fluid" *ngIf="!showConnectForm">
    <div class="row">
      <div class="col-12">
        <ui-data-table
          #liveViewGrid
          [id]="'live-view-grid'"
          [showFooter]="true"
          [page]="1"
          [columns]="tableColumns"
          [dataSource]="tableDataSource"
          [canViewDeleted]="false"
          [selectable]="true"
          [pagination]="false"
          [height]="'calc(100vh - 200px)'"
          [recordHeight]="recordHeight"
          [showEmptyRows]="false"
          [fixedBody]="true"
          [advancedFilter]="false"
          [showRefresh]="true"
          [showLoadingOnReload]="false"
          [scrollToTopOnReload]="false"
          [searchPlaceholder]="'Ara...'"
          [recid]="'Id'"
          [selectType]="'row'"
          [multiSelect]="false"
          [multiSort]="false"
          [keyboard]="true"
          [liveSearch]="true"
          [reorderColumns]="false"
          [reorderRows]="false"
          [lineNumbers]="false"
          [expandColumn]="false"
          [nestedFields]="true"
          [columnTooltip]="'top'"
          [toolbar]="tableToolbarConfig"
          [getRowStyle]="getAccessRowStyle"
          (rowClick)="onTableRowClick($event)"
          (rowDblClick)="onTableRowDblClick($event)"
          (rowSelect)="onTableRowSelect($event)"
          (advancedFilterChange)="onAdvancedFilterChange($event)"
          (refresh)="onTableRefresh()"
          (delete)="onTableDelete($event)"
          (add)="onTableAdd()"
          (edit)="onTableEdit($event)">
        </ui-data-table>
      </div>
    </div>
  </div>
</div>

<!-- Filter Modal -->
<ui-modal
  [show]="showFilterModal"
  [title]="'Terminal Gruplarını Seç'"
  [size]="'lg'"
  [closable]="true"
  [showFooter]="true"
  (showChange)="onCloseFilterModal()">
  <div class="filter-modal-content">
    <div class="form-group">
      <label>Grup:</label>
      <ui-select
        [(ngModel)]="selectedLiveViewSettingId"
        [options]="liveViewSettings"
        [placeholder]="'Grup seçiniz...'"
        (ngModelChange)="onLiveViewSettingChange()">
      </ui-select>
    </div>
    
    <!-- Terminals List -->
    <div class="form-group" *ngIf="selectedTerminals.length > 0">
      <label>Seçili Terminaller ({{ selectedTerminals.length }}):</label>
      <div class="terminals-list-container">
        <ui-data-table
          [id]="'filter-terminals-grid'"
          [columns]="terminalsTableColumns"
          [dataSource]="terminalsDataSource"
          [selectable]="false"
          [pagination]="true"
          [pageSize]="10"
          [height]="'300px'"
          [recid]="'ReaderID'"
          [showRefresh]="false"
          [searchable]="false"
          [showFooter]="true"
          [toolbar]="terminalsTableToolbarConfig">
        </ui-data-table>
      </div>
    </div>
    
    <div class="form-group" *ngIf="selectedLiveViewSettingId && selectedTerminals.length === 0">
      <div class="alert alert-info">
        <i class="ti ti-info-circle me-2"></i>
        Bu grup için terminal bulunamadı.
      </div>
    </div>
  </div>
  
  <div slot="footer" class="modal-footer">
    <button 
      type="button" 
      class="btn btn-secondary" 
      (click)="onCloseFilterModal()">
      İptal
    </button>
    <button 
      type="button" 
      class="btn btn-primary" 
      (click)="onApplyFilter()"
      [disabled]="selectedTerminals.length === 0">
      Tamam
    </button>
  </div>
</ui-modal>

<!-- Row Size Modal -->
<ui-modal
  [show]="showRowSizeModal"
  [title]="'Satır Yüksekliğini Düzenle'"
  [size]="'sm'"
  [closable]="true"
  [showFooter]="true"
  (showChange)="onCloseRowSizeModal()">
  <div class="row-size-modal-content">
    <div class="form-group">
      <label>Satır Yüksekliği:</label>
      <input 
        type="number" 
        class="form-control"
        [(ngModel)]="newRowSize"
        min="40"
        max="200">
    </div>
  </div>
  
  <div slot="footer" class="modal-footer">
    <button 
      type="button" 
      class="btn btn-secondary" 
      (click)="onCloseRowSizeModal()">
      İptal
    </button>
    <button 
      type="button" 
      class="btn btn-primary" 
      (click)="onApplyRowSize()">
      Ayarla
    </button>
  </div>
</ui-modal>

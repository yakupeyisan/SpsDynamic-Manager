<!-- Card Component Template -->
<div class="card-page">
  <div class="container-fluid">
    <!-- Data Table Section -->
    <div class="row">
      <div class="col-12">
        <ui-data-table
          [id]="'cards-grid'"
          [showFooter]="true"
          [page]="1"
          [columns]="tableColumns"
          [dataSource]="tableDataSource"
          [joinOptions]="joinOptions"
          [canViewDeleted]="true"
          [formFields]="formFields"
          [formTabs]="formTabs"
          [formLoadUrl]="formLoadUrl"
          [formFullscreen]="true"
          [formLoadRequest]="formLoadRequest"
          [formDataMapper]="formDataMapper"
          [onSave]="onSave"
          [onFormChange]="onFormChange"
          [selectable]="true"
          [pagination]="true"
          [pageSize]="10"
          [recordHeight]="40"
          [showEmptyRows]="true"
          [fixedBody]="true"
          [advancedFilter]="true"
          [showRefresh]="true"
          [searchPlaceholder]="translate.instant('table.searchPlaceholder')"
          [recid]="'CardID'"
          [selectType]="'row'"
          [multiSelect]="true"
          [multiSort]="true"
          [keyboard]="true"
          [liveSearch]="true"
          [reorderColumns]="false"
          [reorderRows]="false"
          [lineNumbers]="false"
          [expandColumn]="false"
          [nestedFields]="true"
          [columnTooltip]="'top'"
          [toolbar]="tableToolbarConfig"
          (rowClick)="onTableRowClick($event)"
          (rowDblClick)="onTableRowDblClick($event)"
          (rowSelect)="onTableRowSelect($event)"
          (advancedFilterChange)="onAdvancedFilterChange($event)"
          (refresh)="onTableRefresh()"
          (delete)="onTableDelete($event)"
          (add)="onTableAdd()"
          (edit)="onTableEdit($event)">
        </ui-data-table>
      </div>
    </div>
  </div>
</div>

<!-- Bulk Cafeteria Group Change Modal -->
<ui-modal
  [show]="showBulkCafeteriaGroupModal"
  [title]="'Toplu Kafeterya Grubu Değişimi'"
  [size]="'lg'"
  [closable]="true"
  [showFooter]="true"
  (showChange)="onBulkCafeteriaGroupModalChange($event)">
  <div class="cancel-confirmation-content">
    <!-- Warning Alert -->
    <div class="cancel-warning-alert">
      <div class="cancel-warning-icon">
        <i class="ti ti-alert-triangle"></i>
      </div>
      <div class="cancel-warning-text">
        <strong>Uyarı:</strong> Seçili kartların kafeterya grupları değiştirilecektir. Onaylıyor musunuz?
      </div>
    </div>
    
    <!-- Selected Records Section -->
    <div class="cancel-section">
      <div class="cancel-section-header">
        <i class="ti ti-list-check me-2"></i>
        <span class="cancel-section-title">Seçili Kartlar</span>
        <span class="cancel-section-badge">{{ selectedCardsForCafeteriaGroup.length }}</span>
      </div>
      <div class="selected-events-list">
        <div 
          *ngFor="let card of selectedCardsForCafeteriaGroup; let i = index" 
          class="selected-event-item">
          <div class="selected-event-number">{{ i + 1 }}</div>
          <div class="selected-event-content">
            <div class="selected-event-row">
              <span class="selected-event-label">Kart ID:</span>
              <span class="selected-event-value">{{ card['CardID'] || card['recid'] || card['id'] }}</span>
            </div>
            <div *ngIf="card['TagCode']" class="selected-event-row">
              <span class="selected-event-label">Tag Kodu:</span>
              <span class="selected-event-value">{{ card['TagCode'] }}</span>
            </div>
            <div *ngIf="card['CardCode']" class="selected-event-row">
              <span class="selected-event-label">Kart Kodu:</span>
              <span class="selected-event-value">{{ card['CardCode'] }}</span>
            </div>
            <div *ngIf="card['Employee']?.Name || card['Employee']?.SurName" class="selected-event-row">
              <span class="selected-event-label">Kişi:</span>
              <span class="selected-event-value">{{ card['Employee']?.Name || '' }} {{ card['Employee']?.SurName || '' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Cafeteria Group Selection Section -->
    <div class="cancel-section">
      <div class="cancel-section-header">
        <i class="ti ti-building me-2"></i>
        <span class="cancel-section-title">Yeni Kafeterya Grubu</span>
        <span class="text-danger ms-1">*</span>
      </div>
      <ui-select
        [(ngModel)]="selectedCafeteriaGroupId"
        [options]="getCafeteriaGroupOptions()"
        [placeholder]="'Kafeterya grubu seçiniz...'"
        [disabled]="isUpdatingCafeteriaGroup"
        [required]="true">
      </ui-select>
      <div class="cancel-description-hint">
        <i class="ti ti-info-circle"></i>
        <span>Seçili kartların tümü bu kafeterya grubuna atanacaktır.</span>
      </div>
    </div>
  </div>
  
  <div slot="footer" class="cancel-modal-footer">
    <button 
      type="button" 
      class="cancel-btn cancel-btn-secondary" 
      (click)="closeBulkCafeteriaGroupModal()"
      [disabled]="isUpdatingCafeteriaGroup">
      <i class="ti ti-x me-1"></i>
      Vazgeç
    </button>
    <button 
      type="button" 
      class="cancel-btn cancel-btn-primary" 
      (click)="onConfirmBulkCafeteriaGroup()"
      [disabled]="isUpdatingCafeteriaGroup || !selectedCafeteriaGroupId">
      <span *ngIf="isUpdatingCafeteriaGroup" class="cancel-spinner me-2"></span>
      <i *ngIf="!isUpdatingCafeteriaGroup" class="ti ti-check me-1"></i>
      Onayla ve Güncelle
    </button>
  </div>
</ui-modal>

<!-- Bulk Card Status Change Modal -->
<ui-modal
  [show]="showBulkStatusModal"
  [title]="'Toplu Kart Durumu Değiştir'"
  [size]="'lg'"
  [closable]="true"
  [showFooter]="true"
  (showChange)="onBulkStatusModalChange($event)">
  <div class="cancel-confirmation-content">
    <!-- Warning Alert -->
    <div class="cancel-warning-alert">
      <div class="cancel-warning-icon">
        <i class="ti ti-alert-triangle"></i>
      </div>
      <div class="cancel-warning-text">
        <strong>Uyarı:</strong> Seçili kartların durumları değiştirilecektir. Onaylıyor musunuz?
      </div>
    </div>
    
    <!-- Selected Records Section -->
    <div class="cancel-section">
      <div class="cancel-section-header">
        <i class="ti ti-list-check me-2"></i>
        <span class="cancel-section-title">Seçili Kartlar</span>
        <span class="cancel-section-badge">{{ selectedCardsForStatus.length }}</span>
      </div>
      <div class="selected-events-list">
        <div 
          *ngFor="let card of selectedCardsForStatus; let i = index" 
          class="selected-event-item">
          <div class="selected-event-number">{{ i + 1 }}</div>
          <div class="selected-event-content">
            <div class="selected-event-row">
              <span class="selected-event-label">Kart ID:</span>
              <span class="selected-event-value">{{ card['CardID'] || card['recid'] || card['id'] }}</span>
            </div>
            <div *ngIf="card['TagCode']" class="selected-event-row">
              <span class="selected-event-label">Tag Kodu:</span>
              <span class="selected-event-value">{{ card['TagCode'] }}</span>
            </div>
            <div *ngIf="card['CardCode']" class="selected-event-row">
              <span class="selected-event-label">Kart Kodu:</span>
              <span class="selected-event-value">{{ card['CardCode'] }}</span>
            </div>
            <div *ngIf="card['Employee']?.Name || card['Employee']?.SurName" class="selected-event-row">
              <span class="selected-event-label">Kişi:</span>
              <span class="selected-event-value">{{ card['Employee']?.Name || '' }} {{ card['Employee']?.SurName || '' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Status Selection Section -->
    <div class="cancel-section">
      <div class="cancel-section-header">
        <i class="ti ti-toggle-right me-2"></i>
        <span class="cancel-section-title">Kart Durumu</span>
        <span class="text-danger ms-1">*</span>
      </div>
      <ui-select
        [(ngModel)]="selectedStatus"
        [options]="statusOptions"
        [placeholder]="'Durum seçiniz (Aktif / Pasif)...'"
        [disabled]="isUpdatingStatus"
        [required]="true">
      </ui-select>
      <div class="cancel-description-hint">
        <i class="ti ti-info-circle"></i>
        <span>Aktif: Kart kullanıma açık. Pasif: Kart kullanıma kapalı.</span>
      </div>
    </div>
  </div>
  
  <div slot="footer" class="cancel-modal-footer">
    <button 
      type="button" 
      class="cancel-btn cancel-btn-secondary" 
      (click)="closeBulkStatusModal()"
      [disabled]="isUpdatingStatus">
      <i class="ti ti-x me-1"></i>
      Vazgeç
    </button>
    <button 
      type="button" 
      class="cancel-btn cancel-btn-primary" 
      (click)="onConfirmBulkStatus()"
      [disabled]="isUpdatingStatus || selectedStatus === null || selectedStatus === undefined">
      <span *ngIf="isUpdatingStatus" class="cancel-spinner me-2"></span>
      <i *ngIf="!isUpdatingStatus" class="ti ti-check me-1"></i>
      Onayla ve Güncelle
    </button>
  </div>
</ui-modal>

<!-- Card Write Modal -->
<ui-modal
  [show]="showCardWriteModal"
  [title]="'Kart Yazdırma'"
  [size]="'lg'"
  [closable]="true"
  [showFooter]="true"
  (showChange)="onCardWriteModalChange($event)">
  <div class="cancel-confirmation-content">
    <!-- Warning Alert -->
    <div class="cancel-warning-alert">
      <div class="cancel-warning-icon">
        <i class="ti ti-alert-triangle"></i>
      </div>
      <div class="cancel-warning-text">
        <strong>Uyarı:</strong> Seçili kartlar yazdırılacaktır. Onaylıyor musunuz?
      </div>
    </div>
    
    <!-- Selected Records Section -->
    <div class="cancel-section">
      <div class="cancel-section-header">
        <i class="ti ti-list-check me-2"></i>
        <span class="cancel-section-title">Yazdırılacak Kartlar</span>
        <span class="cancel-section-badge">{{ selectedCardsForWrite.length }}</span>
      </div>
      <div class="selected-events-list">
        <div 
          *ngFor="let card of selectedCardsForWrite; let i = index" 
          class="selected-event-item">
          <div class="selected-event-number">{{ i + 1 }}</div>
          <div class="selected-event-content">
            <div class="selected-event-row">
              <span class="selected-event-label">Kart ID:</span>
              <span class="selected-event-value">{{ card['CardID'] || card['recid'] || card['id'] }}</span>
            </div>
            <div *ngIf="card['TagCode']" class="selected-event-row">
              <span class="selected-event-label">Tag Kodu:</span>
              <span class="selected-event-value">{{ card['TagCode'] }}</span>
            </div>
            <div *ngIf="card['CardCode']" class="selected-event-row">
              <span class="selected-event-label">Kart Kodu:</span>
              <span class="selected-event-value">{{ card['CardCode'] }}</span>
            </div>
            <div *ngIf="card['Employee']?.Name || card['Employee']?.SurName" class="selected-event-row">
              <span class="selected-event-label">Kişi:</span>
              <span class="selected-event-value">{{ card['Employee']?.Name || '' }} {{ card['Employee']?.SurName || '' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Card Template Selection Section -->
    <div class="cancel-section">
      <div class="cancel-section-header">
        <i class="ti ti-file-text me-2"></i>
        <span class="cancel-section-title">Kart Şablonu</span>
        <span class="text-danger ms-1">*</span>
      </div>
      <ui-select
        [(ngModel)]="selectedCardTemplateId"
        [options]="getCardTemplateOptions()"
        [placeholder]="'Kart şablonu seçiniz...'"
        [disabled]="isWritingCards || isLoadingCardTemplates"
        [required]="true">
      </ui-select>
      <div class="cancel-description-hint" *ngIf="isLoadingCardTemplates">
        <i class="ti ti-loader"></i>
        <span>Kart şablonları yükleniyor...</span>
      </div>
      <div class="cancel-description-hint" *ngIf="!isLoadingCardTemplates">
        <i class="ti ti-info-circle"></i>
        <span>Yazdırılacak kartlar için kullanılacak şablonu seçiniz.</span>
      </div>
    </div>
  </div>
  
  <div slot="footer" class="cancel-modal-footer">
    <button 
      type="button" 
      class="cancel-btn cancel-btn-secondary" 
      (click)="closeCardWriteModal()"
      [disabled]="isWritingCards">
      <i class="ti ti-x me-1"></i>
      Vazgeç
    </button>
    <button 
      type="button" 
      class="cancel-btn cancel-btn-primary" 
      (click)="onConfirmCardWrite()"
      [disabled]="isWritingCards || selectedCardsForWrite.length === 0 || !selectedCardTemplateId">
      <span *ngIf="isWritingCards" class="cancel-spinner me-2"></span>
      <i *ngIf="!isWritingCards" class="ti ti-printer me-1"></i>
      Onayla ve Yazdır
    </button>
  </div>
</ui-modal>
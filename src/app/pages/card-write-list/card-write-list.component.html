<!-- CardWriteList Component Template -->
<div class="card-write-list-page">
  <div class="container-fluid">
    <!-- Data Table Section -->
    <div class="row">
      <div class="col-12">
        <ui-data-table
          [id]="'card-write-list-grid'"
          [showFooter]="true"
          [page]="1"
          [columns]="tableColumns"
          [dataSource]="tableDataSource"
          [joinOptions]="joinOptions"
          [canViewDeleted]="true"
          [formFields]="formFields"
          [formTabs]="formTabs"
          [formLoadUrl]="formLoadUrl"
          [formFullscreen]="true"
          [formLoadRequest]="formLoadRequest"
          [formDataMapper]="formDataMapper"
          [onSave]="onSave"
          [onFormChange]="onFormChange"
          [selectable]="true"
          [pagination]="true"
          [pageSize]="10"
          [recordHeight]="40"
          [showEmptyRows]="true"
          [fixedBody]="true"
          [advancedFilter]="true"
          [showRefresh]="true"
          [searchPlaceholder]="translate.instant('table.searchPlaceholder')"
          [recid]="'Id'"
          [selectType]="'row'"
          [multiSelect]="true"
          [multiSort]="true"
          [keyboard]="true"
          [liveSearch]="true"
          [reorderColumns]="false"
          [reorderRows]="false"
          [lineNumbers]="false"
          [expandColumn]="false"
          [nestedFields]="true"
          [columnTooltip]="'top'"
          [toolbar]="tableToolbarConfig"
          (rowClick)="onTableRowClick($event)"
          (rowDblClick)="onTableRowDblClick($event)"
          (rowSelect)="onTableRowSelect($event)"
          (advancedFilterChange)="onAdvancedFilterChange($event)"
          (refresh)="onTableRefresh()"
          (delete)="onTableDelete($event)"
          (add)="onTableAdd()"
          (edit)="onTableEdit($event)">
        </ui-data-table>
      </div>
    </div>
  </div>
</div>

<!-- Preview Modal -->
<ui-modal
  [show]="showPreviewModal"
  [title]="'Kart Yazdırma Önizlemesi'"
  [size]="'xl'"
  [closable]="true"
  [showFooter]="true"
  (showChange)="showPreviewModal = $event"
  (closed)="closePreviewModal()">
  
  <div *ngIf="isLoadingPreview" style="text-align: center; padding: 40px;">
    <div class="spinner-border" role="status">
      <span class="sr-only">Yükleniyor...</span>
    </div>
    <p style="margin-top: 20px;">Önizleme hazırlanıyor...</p>
  </div>
  
  <div *ngIf="!isLoadingPreview" class="card-write-list-preview-wrap">
    <div class="card-write-list-preview-toolbar">
      <label class="card-write-list-select-all">
        <input type="checkbox" [checked]="allPreviewPrintSelected" (change)="selectAllPreviewPrint($any($event.target).checked)" class="form-check-input">
        <span>Tümünü seç</span>
      </label>
      <label class="card-write-list-print-with-template">
        <input type="checkbox" [(ngModel)]="previewPrintWithTemplate" class="form-check-input">
        <span>Şablon ile birlikte yazdır</span>
      </label>
    </div>
    <div class="card-write-list-preview-list">
      <div *ngFor="let item of previewData; let i = index" class="card-write-list-preview-row" [class.card-write-list-preview-row-disabled]="previewWritedAtFilled[i]">
        <label class="card-write-list-preview-checkbox">
          <input type="checkbox" [checked]="previewPrintSelection[i]" (change)="onPreviewPrintSelect(i, $any($event.target).checked)" [disabled]="previewWritedAtFilled[i]" class="form-check-input" [attr.data-index]="i" [attr.aria-label]="'Kart ' + (i + 1) + ' yazdır'">
        </label>
        <div class="card-write-list-preview-content" [innerHTML]="previewCardHtmls[i]"></div>
      </div>
    </div>
  </div>
  
  <div slot="footer" class="card-write-list-preview-footer">
    <div class="text-muted small">
      <ng-container *ngIf="previewData.length">Önlü arkalı kartlarda önce ön yüz, sonra arka yüz sayfa sırasıyla yazdırılır.</ng-container>
    </div>
    <div class="card-write-list-preview-footer-actions">
      <button type="button" class="btn btn-primary" (click)="printSelectedPreview()" [disabled]="!hasAnyPreviewPrintSelected">
        <i class="ti ti-printer me-1"></i>
        Yazdır
      </button>
      <button type="button" class="btn btn-secondary" (click)="closePreviewModal()">
        <i class="ti ti-x me-1"></i>
        Kapat
      </button>
    </div>
  </div>
</ui-modal>
